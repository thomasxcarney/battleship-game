(()=>{"use strict";const n=function(n,e){return{name:e,length:n,hits:0,sunk:"not sunk",hit:function(){this.hits+=1,this.isSunk()},isSunk:function(){return this.hits===this.length&&(this.sunk="sunk"),this.sunk}}},e=function(){const e=function(){const n=["A","B","C","D","E","F","G","H","I","J"],e=["1","2","3","4","5","6","7","8","9","10"],t=[];for(let s=0;s<n.length;s+=1){const r=n[s];for(let n=0;n<e.length;n+=1){const s={name:r+e[n],shipOnSpace:null};t.push(s)}}return t}(),t=[];t.push(...e);const s=function(){const e=n(5,"carrier"),t=n(4,"battleship"),s=n(3,"destroyer"),r=n(3,"submarine"),i=n(2,"patrol boat"),c=[];return c.push(e,t,s,r,i),c}(),r=[],i=[];return{name:null,boardArr:t,shipsToPlace:s,placeShip:function(e,s,i){const c=n(e);r.push(c);const o=t.find((n=>n.name===s)),a=t.find((n=>n.name===i));if(o.name[0]===a.name[0])for(let n=t.indexOf(o);n<=t.indexOf(a);n+=1)t[n].shipOnSpace=c;else if(o.name[1]===a.name[1])for(let n=t.indexOf(o);n<=t.indexOf(a);n+=10)t[n].shipOnSpace=c},receiveAttack:function(n){const e=t.find((e=>e.name===n));return e.shipOnSpace?(e.shipOnSpace.hit(),"hit"):(i.push(n),"miss")},checkIfAllShipsSunk:function(){return!!r.every((n=>"sunk"===n.sunk))&&(this.allSunk=!0,!0)}}},t=function(){const n=[],e=["A","B","C","D","E","F","G","H","I","J"],t=function(){const n=function(n,e){return Math.floor(Math.random()*(e-n+1)+n)};return e[n(1,9)]+n(1,10)};return{compAttack:function(e){const s=e.filter((e=>!n.includes(e.name)));let r=t();return function n(e){return s.find((n=>n.name===e))||(r=t(),n(r)),e}(r)},board:null,isTurn:!1,checkTurnAndAttack:function(n){const e=document.getElementById("computer-name");if(this.isTurn){e.classList.add("isTurn");const t=this.compAttack(n),s=document.getElementById(`player1 ${t}`);setTimeout((()=>{s.click()}),3e3)}else this.isTurn||e.classList.remove("isTurn")},placeComputerShips:function(){const n=this.board.shipsToPlace,{board:e}=this,s=function(n){const t=e.boardArr.findIndex((e=>e.name===n));return null===e.boardArr[t].shipOnSpace},r=function n(r){let i=t();document.getElementById(`computerPlayer ${i}`).classList.contains("hasShip")&&(i=t());const c=r.length;{let t;if(i.split("").length>2){const n=i.substring(1),e=i.split("").splice(1,1,n);t=Number(e[1]),console.log(i,e)}else 2===i.split("").length&&(t=Number(i.split("")[1]));const o=t+(r.length-1);if(o>10)n(r);else if(o<=10){const t=i.split("")[0].concat(o);for(let e=0;e<r.length-1;e++)if(!s(i.split("")[0].concat(Number(i.split("")[1])+e)))return n(r);const a=[c,i,t];return console.log(r.name,a),e.placeShip(a[0],a[1],a[2])}}};n.forEach((n=>{r(n)}))}}},s=(document.getElementById("header"),document.getElementById("game-info"),document.getElementById("game"),function(){const n={board:null,isTurn:!0,checkTurn:function(){const n=document.getElementById("player-name");this.isTurn?n.classList.add("isTurn"):this.isTurn||n.classList.remove("isTurn")},placePlayerShips:function(){this.board.shipsToPlace.forEach((n=>{const e=prompt(`Enter coordinates to place ${n.name} (${n.length} cells long) format A1 A5`).split(" ");this.board.placeShip(`${n.length}`,e[0].toUpperCase(),e[1].toUpperCase())}))}};n.board=e(),n.board.name="player1";const s=t();return s.board=e(),s.board.name="computerPlayer",{player1:n,computerPlayer:s,switchTurns:function(){n.board.checkIfAllShipsSunk()?alert("Game over! Player Loses"):s.board.checkIfAllShipsSunk()&&alert("Game over! Player Wins"),n.isTurn?(n.isTurn=!1,s.isTurn=!0):s.isTurn&&(n.isTurn=!0,s.isTurn=!1),n.checkTurn(),s.checkTurnAndAttack(n.board.boardArr)}}}());!function(){const n=document.getElementById("playerBoardContainer"),e=document.getElementById("computerBoardContainer"),t=s.player1.board,r=s.computerPlayer.board,i=function(n,e,t){const{boardArr:r}=n;r.forEach((r=>{const i=document.createElement("div");!function(n,e,t,r){n.addEventListener("click",(()=>{r.isTurn||("hit"===t.receiveAttack(e.name)?n.classList.add("hit-cell"):"miss"===t.receiveAttack(e.name)&&n.classList.add("miss-cell"),s.switchTurns())}))}(i,r,n,t),i.classList.add("gridSquare"),i.setAttribute("id",`${n.name} ${r.name}`),null!=r.shipOnSpace&&i.classList.add("hasShip"),i.innerHTML=r.name,e.append(i)}))},c=function(n,e,t){e.innerHTML="",i(n,e,t)};i(r,e,s.computerPlayer),i(t,n,s.player1),document.getElementById("place-ships-button").addEventListener("click",(()=>{s.player1.placePlayerShips(),c(t,n,s.player1)})),document.getElementById("place-comp-ships-button").addEventListener("click",(()=>{s.computerPlayer.placeComputerShips(),c(r,e,s.computerPlayer)}))}()})();