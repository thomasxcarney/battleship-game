(()=>{"use strict";const n=function(n,e){return{name:e,length:n,hits:0,sunk:"not sunk",hit:function(){this.hits+=1,this.isSunk()},isSunk:function(){return this.hits===this.length&&(this.sunk="sunk"),this.sunk}}},e=function(){const e=function(){const n=["A","B","C","D","E","F","G","H","I","J"],e=["1","2","3","4","5","6","7","8","9","10"],t=[];for(let r=0;r<n.length;r+=1){const s=n[r];for(let n=0;n<e.length;n+=1){const r={name:s+e[n],shipOnSpace:null};t.push(r)}}return t}(),t=[];t.push(...e);const r=function(){const e=n(5,"carrier"),t=n(4,"battleship"),r=n(3,"destroyer"),s=n(3,"submarine"),c=n(2,"patrol boat"),i=[];return i.push(e,t,r,s,c),i}(),s=[],c=[];return{name:null,boardArr:t,shipsToPlace:r,placeShip:function(e,r,c){const i=n(e);s.push(i);const o=t.find((n=>n.name===r)),a=t.find((n=>n.name===c));if(o.name[0]===a.name[0])for(let n=t.indexOf(o);n<=t.indexOf(a);n+=1)t[n].shipOnSpace=i;else if(o.name[1]===a.name[1])for(let n=t.indexOf(o);n<=t.indexOf(a);n+=10)t[n].shipOnSpace=i},receiveAttack:function(n){const e=t.find((e=>e.name===n));return e.shipOnSpace?(e.shipOnSpace.hit(),"hit"):(c.push(n),"miss")},checkIfAllShipsSunk:function(){return!!s.every((n=>"sunk"===n.sunk))&&(this.allSunk=!0,!0)}}},t=function(){const n=[],e=["A","B","C","D","E","F","G","H","I","J"],t=function(){const n=function(n,e){return Math.floor(Math.random()*(e-n+1)+n)};return e[n(1,9)]+n(1,10)};return{compAttack:function(e){const r=e.filter((e=>!n.includes(e.name)));let s=t();return function n(e){return r.find((n=>n.name===e))||(s=t(),n(s)),e}(s)},board:null,isTurn:!1,checkTurnAndAttack:function(n){const e=document.getElementById("computer-name");if(this.isTurn){e.classList.add("isTurn");const t=this.compAttack(n),r=document.getElementById(`player1 ${t}`);setTimeout((()=>{r.click()}),3e3)}else this.isTurn||e.classList.remove("isTurn")},placeComputerShips:function(){const n=this.board.shipsToPlace,{board:r}=this;console.log(n);const s=function(n){const e=r.boardArr.findIndex((e=>e.name===n));return null===r.boardArr[e].shipOnSpace},c=function n(c){let i=t();document.getElementById(`computerPlayer ${i}`).classList.contains("hasShip")&&(i=t());const o=c.length,a=Math.random()<.5?"horizontal":"vertical";if("horizontal"===a){const e=Number(i.split("")[1])+(c.length-1);if(e>10)n(c);else if(e<=10){const t=i.split("")[0].concat(e);for(let e=0;e<c.length-1;e++)if(!s(i.split("")[0].concat(Number(i.split("")[1])+e)))return n(c);const a=[o,i,t];return r.placeShip(a[0],a[1],a[2])}}if("vertical"===a){const t=i.split("")[0],a=i.split("")[1],l=e.indexOf(t),u=l+(o-1);if(u>9)n(c);else if(u<=9){for(let t=0;t<o-1;t++){const r=e[l+t].concat(a);if(!s(r))return n(c)}const t=[o,i,e[u].concat(a)];return r.placeShip(t[0],t[1],t[2])}}};n.forEach((n=>{c(n)}))}}},r=(document.getElementById("header"),document.getElementById("game-info"),document.getElementById("game"),function(){const n={board:null,isTurn:!0,checkTurn:function(){const n=document.getElementById("player-name");this.isTurn?n.classList.add("isTurn"):this.isTurn||n.classList.remove("isTurn")},placePlayerShips:function(){this.board.shipsToPlace.forEach((n=>{const e=prompt(`Enter coordinates to place ${n.name} (${n.length} cells long) format A1 A5`).split(" ");this.board.placeShip(`${n.length}`,e[0],e[1])}))}};n.board=e(),n.board.name="player1";const r=t();return r.board=e(),r.board.name="computerPlayer",{player1:n,computerPlayer:r,switchTurns:function(){n.board.checkIfAllShipsSunk()?alert("Game over! Player Loses"):r.board.checkIfAllShipsSunk()&&alert("Game over! Player Wins"),n.isTurn?(n.isTurn=!1,r.isTurn=!0):r.isTurn&&(n.isTurn=!0,r.isTurn=!1),n.checkTurn(),r.checkTurnAndAttack(n.board.boardArr)}}}());!function(){const n=document.getElementById("playerBoardContainer"),e=document.getElementById("computerBoardContainer"),t=r.player1.board,s=r.computerPlayer.board,c=function(n,e,t){const{boardArr:s}=n;s.forEach((s=>{const c=document.createElement("div");!function(n,e,t,s){n.addEventListener("click",(()=>{s.isTurn||("hit"===t.receiveAttack(e.name)?n.classList.add("hit-cell"):"miss"===t.receiveAttack(e.name)&&n.classList.add("miss-cell"),r.switchTurns())}))}(c,s,n,t),c.classList.add("gridSquare"),c.setAttribute("id",`${n.name} ${s.name}`),null!=s.shipOnSpace&&c.classList.add("hasShip"),c.innerHTML=s.name,e.append(c)}))},i=function(n,e,t){e.innerHTML="",c(n,e,t)};c(s,e,r.computerPlayer),c(t,n,r.player1),document.getElementById("place-ships-button").addEventListener("click",(()=>{r.player1.placePlayerShips(),i(t,n,r.player1)})),document.getElementById("place-comp-ships-button").addEventListener("click",(()=>{r.computerPlayer.placeComputerShips(),i(s,e,r.computerPlayer)}))}()})();